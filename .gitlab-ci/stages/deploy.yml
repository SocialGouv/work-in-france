#

.deploy_stage: &deploy_stage
  stage: "Deploy"
  dependencies: []
  services:
    - docker:dind
  variables: &deploy_stage_variables
    IMAGE_TAG: $CI_COMMIT_SHA

.incubateur_stage: &incubateur_stage
  environment:
    name: incubateur
  only:
    - tags

.dev_stage: &dev_stage
  environment:
    name: dev.factory
  only:
    - branches

.docker_kube_dev_stage: &docker_kube_dev_stage
  before_script:
    - source .gitlab-ci/env.sh

#
#
#

.deploy-app: &deploy_app
  <<: *deploy_stage
  variables:
    <<: *deploy_stage_variables
    CDTN_REGISTRY: $CI_REGISTRY_IMAGE
    ES_INTER_NODE: $ELASTICSEARCH_INTER_NODE_PORT
    ES_PORT: $ELASTICSEARCH_PORT

#

Deploy App (dev):
  <<: *deploy_app
  <<: *dev_stage
  <<: *docker_kube_dev_stage
  extends: .k8s-fontend-depoyment

Deploy App (incubateur):
  <<: *deploy_app
  <<: *incubateur_stage
  <<: *docker_kube_dev_stage
  extends: .dk8s-fontend-depoyment
