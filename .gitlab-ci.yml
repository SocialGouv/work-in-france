include:
  - project: SocialGouv/gitlab-ci-yml
    file: /autodevops_simple_app.yml
    ref: v17.1.0

variables:
  PROJECT: work-in-france
  RANCHER_PROJECT_ID: "c-kk8xm:p-gj8cn" # "default" project id here
  VALUES_FILE: ./.k8s/app.values.yml # Your values
  DOCKER_BUILD_ARGS: "--shm-size 512M"
  PORT: 80

#

Build:
  extends:
    - .base_yarn_build_next
  dependencies:
    - Install
  needs:
    - Install
  variables:
    BACKOFFICE_API_URL: "%%BACKOFFICE_API_URL%%"
    DS_AGGREGATOR_API_URL: "%%DS_AGGREGATOR_API_URL%%"
    VERSION: ${CI_COMMIT_SHORT_SHA}
  script:
    - yarn build
    - yarn export
  artifacts:
    expire_in: 1 day
    paths:
      - out
